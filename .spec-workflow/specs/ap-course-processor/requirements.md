# 需求规格说明书 - AP 课程处理工具

## 1. 项目概述

### 1.1 项目名称
PrepGo AP 课程处理工具（AP Course Processor）

### 1.2 项目目标
创建一个 Web 应用程序，用于自动化处理 AP 课程的 College Board 官方 CED (Course and Exam Description) PDF 文件，将其解析为结构化的 JSON 数据，并提供可视化界面进行预览和编辑。

### 1.3 目标用户
- 教育内容开发人员
- PrepGo 课程设计师
- AP 课程教学研究人员

### 1.4 核心价值
- **自动化提取**：自动从 PDF 中提取 Unit、Topic、Learning Objectives 等结构化数据
- **数据验证**：确保提取的数据与 CED 文档保持一致
- **可视化预览**：提供 PDF 与 JSON 数据的左右对照视图
- **高效编辑**：支持在线编辑和导出 JSON 数据

## 2. 功能需求

### FR-1: 双文件上传
**作为** 课程开发人员  
**我想要** 上传 AP 课程的 CED PDF 文件和已提取的 JSON 数据  
**以便** 系统可以进行数据处理和对照展示

**验收标准**：
- **给定** 用户访问主页
- **当** 选择 PDF 文件和 JSON 文件
- **那么** 系统应该接受 .pdf 和 .json 格式文件
- **并且** 文件大小限制为 50MB
- **并且** 两个文件都选择后才能开始处理
- **并且** 显示上传和处理进度指示器
- **并且** 处理成功后显示确认消息

### FR-2: 数据统计计算
**作为** 课程开发人员  
**我想要** 系统自动计算课程统计数据  
**以便** 获得课程结构的详细分析

**验收标准**：
- **给定** JSON 文件已成功上传
- **当** 系统开始处理数据
- **那么** 应该计算以下统计信息：
  - 课程级别统计（总单元数、总主题数、总学习目标数、总知识点数）
  - 单元级别统计（每个单元的主题数、学习目标数、知识点数、课时数、考试权重）
  - 知识点层级分布（KC-1.1, KC-1.1.I, KC-1.1.I.A 等各层级的数量和示例）
  - 考试权重分析（权重范围、平均值、学习效率指标）
- **并且** 提取课时数（从 "~8 Class Periods" 格式）
- **并且** 提取权重范围（从 "4-6%" 格式）
- **并且** 计算学习效率（权重/课时比）
- **并且** 显示处理进度
- **并且** 处理完成后合并原始数据和计算数据

### FR-3: JSON 数据预览
**作为** 课程开发人员  
**我想要** 在界面上预览生成的 JSON 数据  
**以便** 验证数据的正确性

**验收标准**：
- **给定** 数据已成功处理
- **当** 用户查看预览界面
- **那么** 应该显示：
  - 格式化的 JSON 数据（带语法高亮）
  - 可折叠的树形结构视图
  - 数据统计信息（Units 数量、Topics 数量、统计数据等）
  - 原始数据和计算数据的完整视图
- **并且** 支持复制 JSON 内容到剪贴板
- **并且** 支持展开/折叠所有节点

### FR-4: PDF 与 JSON 对照视图
**作为** 课程开发人员  
**我想要** 左右对照查看 PDF 和 JSON 数据  
**以便** 快速验证数据的准确性

**验收标准**：
- **给定** 数据已处理完成
- **当** 用户进入对照视图
- **那么** 应该显示：
  - 左侧：PDF 浏览器（可滚动、翻页）
  - 右侧：JSON 数据树形视图（原始+计算数据）
  - 同步滚动功能（可选）
- **并且** 点击 JSON 中的某个项目时，PDF 应跳转到对应页面
- **并且** 两侧内容应可独立滚动
- **并且** 支持调整左右分栏比例

### FR-5: JSON 数据编辑
**作为** 课程开发人员  
**我想要** 在线编辑 JSON 数据  
**以便** 修正自动提取中的错误

**验收标准**：
- **给定** JSON 数据已生成
- **当** 用户点击编辑按钮
- **那么** 应该提供：
  - 富文本编辑器（支持语法验证）
  - 字段级别的编辑功能
  - 实时 JSON 格式验证
- **并且** 显示编辑状态指示器
- **并且** 支持撤销/重做操作
- **并且** 保存前进行数据验证

### FR-6: JSON 数据导出
**作为** 课程开发人员  
**我想要** 导出处理后的 JSON 数据  
**以便** 用于后续的课程开发工作

**验收标准**：
- **给定** JSON 数据已生成或编辑完成
- **当** 用户点击导出按钮
- **那么** 应该提供以下导出选项：
  - 下载为 .json 文件
  - 复制到剪贴板
  - 下载为"原始数据 JSON"（仅包含 CED 原始内容）
- **并且** 文件名应包含课程名称和时间戳
- **并且** 导出前进行最终验证

### FR-7: 错误处理与验证
**作为** 系统  
**我想要** 妥善处理各种错误情况  
**以便** 提供良好的用户体验

**验收标准**：
- **给定** 用户使用系统
- **当** 发生以下错误：
  - 上传非 PDF 或非 JSON 文件
  - JSON 数据格式无效
  - JSON 数据结构不符合规范
  - 数据处理失败
  - 网络连接问题
- **那么** 应该显示：
  - 清晰的错误提示消息
  - 建议的解决方案
  - 重试选项（如适用）
- **并且** 记录错误日志供调试

### FR-8: 进度指示
**作为** 用户  
**我想要** 看到操作的进度反馈  
**以便** 了解系统正在工作

**验收标准**：
- **给定** 执行长时间操作（上传、数据处理）
- **当** 操作进行中
- **那么** 应该显示：
  - 进度条或百分比
  - 当前步骤描述（读取文件、计算统计、合并数据等）
  - 预计剩余时间（如可计算）
- **并且** 允许用户取消操作
- **并且** 操作完成后显示成功消息

## 3. 非功能性需求

### NFR-1: 性能
- 文件上传响应时间 < 2 秒
- JSON 数据处理时间 < 5 秒（大型课程）
- JSON 预览渲染时间 < 1 秒
- 界面交互响应时间 < 100ms

### NFR-2: 兼容性
- 支持现代浏览器（Chrome 90+, Firefox 90+, Safari 14+, Edge 90+）
- 支持响应式设计（桌面、平板）
- 最低屏幕分辨率：1280x720

### NFR-3: 可用性
- 界面语言：简体中文
- 操作流程不超过 3 步
- 关键操作提供快捷键
- 提供操作提示和帮助文档

### NFR-4: 可维护性
- 代码遵循 TypeScript 严格模式
- 组件化设计，单一职责原则
- 完整的类型定义
- 代码注释覆盖率 > 20%

### NFR-5: 安全性
- 文件上传仅限 PDF 格式
- 文件大小限制验证
- 防止 XSS 攻击
- 不持久化敏感数据

### NFR-6: 可扩展性
- 支持未来添加更多 AP 课程
- 模块化设计便于功能扩展
- API 设计考虑版本控制

## 4. 数据结构规范

### 4.1 原始数据 JSON 结构
```json
{
  "course_name": "AP U.S. History",
  "units": [
    {
      "unit_number": 1,
      "unit_title": "Period 1: 1491-1607",
      "ced_class_periods": "~8 Class Periods",
      "exam_weight": "4-6%",
      "topics": [
        {
          "topic_number": "1.1",
          "topic_title": "Contextualizing Period 1",
          "learning_objectives": [
            {
              "id": "Unit 1: Learning Objective A",
              "summary": "Explain the context for European encounters in the Americas from 1491 to 1607."
            }
          ],
          "essential_knowledge": [
            {
              "id": "KC-1.1",
              "summary": "As native populations migrated and settled across North America, they developed distinct and complex societies by adapting to and transforming their diverse environments."
            }
          ]
        }
      ]
    }
  ]
}
```

**注意**：此结构严格遵循 College Board CED 文档格式和 Gemini 提取的实际数据结构。

## 5. 技术约束

### TC-1: 技术栈
- **前端框架**：Next.js 15+ (App Router)
- **开发语言**：TypeScript 5+
- **样式框架**：Tailwind CSS 3+
- **PDF 处理**：react-pdf (wojtekmaj/react-pdf)
- **PDF 解析**：PDF.js 或 pdf-parse（服务端）
- **代码编辑器**：Monaco Editor 或 CodeMirror
- **状态管理**：React Hooks (useState, useReducer)

### TC-2: 部署要求
- 支持 Vercel 或 Netlify 部署
- 无需外部数据库
- 客户端处理为主，服务端辅助

### TC-3: 开发工具
- Node.js 18+
- pnpm 或 npm
- ESLint + Prettier
- Git 版本控制

## 6. 用户故事优先级

| 优先级 | 功能需求 | 依赖关系 |
|--------|----------|----------|
| P0 (必须) | FR-1: PDF 上传 | - |
| P0 (必须) | FR-2: PDF 解析 | FR-1 |
| P0 (必须) | FR-3: JSON 预览 | FR-2 |
| P1 (重要) | FR-4: 对照视图 | FR-2, FR-3 |
| P1 (重要) | FR-6: JSON 导出 | FR-3 |
| P2 (次要) | FR-5: JSON 编辑 | FR-3 |
| P2 (次要) | FR-7: 错误处理 | 所有 |
| P3 (优化) | FR-8: 进度指示 | 所有 |

## 7. 验收测试场景

### 场景 1：完整的工作流程
1. 用户打开应用
2. 上传 AP U.S. History CED PDF
3. 等待解析完成（显示进度）
4. 查看 JSON 预览
5. 切换到对照视图验证数据
6. 导出 JSON 文件

**预期结果**：所有步骤成功完成，导出的 JSON 数据准确

### 场景 2：错误处理
1. 用户尝试上传非 PDF 文件
2. 系统显示错误提示
3. 用户上传损坏的 PDF
4. 系统显示解析失败提示和重试选项

**预期结果**：错误被正确捕获和显示

### 场景 3：数据验证
1. 解析完成后
2. 对比 PDF 原文和 JSON 数据
3. 验证 Unit 数量、Topic 数量、LO/EK 对应关系

**预期结果**：数据 100% 准确

## 8. 成功指标

- **准确性**：JSON 提取准确率 > 95%
- **效率**：完成一个课程处理时间 < 5 分钟
- **可用性**：用户无需培训即可使用
- **稳定性**：解析成功率 > 98%

## 9. 未来扩展（Out of Scope）

以下功能不在当前版本范围内，但为未来扩展预留接口：
- 批量处理多个 PDF 文件
- 课程内容自动生成（Study Guide, Flashcards, Quiz）
- 时长计算功能
- 用户账户和云存储
- 协作编辑功能
- AI 辅助内容增强

## 10. 相关文档

- College Board AP CED 文档格式规范
- PrepGo 课程开发工作流文档
- JSON 数据结构规范文档
